<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UberEats çå‹µè¨ˆç®—æ©Ÿ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --uber-green: #06C167;
            --uber-black: #000000;
        }
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #F6F8FA;
            color: #1F2937;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .premium-card {
            background: #FFFFFF;
            border-radius: 24px;
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .reward-input {
            height: 44px;
            font-size: 15px;
            text-align: center;
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            transition: all 0.2s;
            font-weight: 600;
            width: 100%;
        }
        .reward-input:focus {
            outline: none;
            border-color: var(--uber-green);
            background-color: #FFFFFF;
            box-shadow: 0 0 0 4px rgba(6, 193, 103, 0.1);
        }
        .meta-input {
            height: 46px;
            font-size: 16px;
            text-align: center;
        }
        .chip-btn {
            padding: 8px 20px;
            border-radius: 99px;
            font-size: 13px;
            font-weight: 700;
            border: 1.5px solid #E5E7EB;
            color: #6B7280;
            background: white;
            transition: all 0.2s;
        }
        .chip-btn.active {
            background-color: var(--uber-green);
            color: white;
            border-color: var(--uber-green);
        }
        .hero-gradient {
            background: linear-gradient(135deg, #06C167 0%, #048d4b 100%);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .export-hidden {
            position: fixed;
            left: -5000px;
            top: 0;
            z-index: -1;
        }
    </style>
</head>
<body class="pb-16 text-sm">

    <!-- 1. é ‚éƒ¨æ¨™é¡Œåˆ— (ç¶ è‰²æ¼¸å±¤) -->
    <nav class="sticky top-0 z-50 hero-gradient border-b border-white/10 px-6 py-5 shadow-lg text-white">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3 text-center">
                <div class="bg-white p-2.5 rounded-xl shadow-md text-center shrink-0">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#06C167" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                </div>
                <span class="text-xl font-black tracking-tighter uppercase whitespace-nowrap">UberEats <span class="text-white opacity-90">çå‹µè¨ˆç®—æ©Ÿ</span></span>
            </div>
            <button onclick="clearAll()" class="text-xs font-bold text-white/60 hover:text-white transition-colors shrink-0">é‡ç½®æ•¸æ“š</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 md:px-6 py-8 space-y-8">
        
        <!-- 2. æ ¸å¿ƒè³‡è¨Šè¼¸å…¥å¡ç‰‡ (æ‰‹æ©Ÿç‰ˆå¼·åˆ¶æ©«æ’) -->
        <section class="premium-card p-4 md:p-6 border-none shadow-lg text-center">
            <div class="grid grid-cols-3 gap-3 md:gap-6 text-center">
                <div class="space-y-2 text-center">
                    <label class="text-xs md:text-sm font-black text-gray-400 uppercase tracking-widest block text-center">è£½ä½œæ—¥æœŸ</label>
                    <input type="date" id="creator-date" class="reward-input meta-input bg-gray-50 border-gray-100 !h-10 md:!h-11 !text-xs md:!text-sm px-1 md:px-4">
                </div>
                <div class="space-y-2 text-center">
                    <label class="text-xs md:text-sm font-black text-gray-400 uppercase tracking-widest block text-center">åŸ·è¡Œåœ°å€</label>
                    <input type="text" id="creator-region" placeholder="åœ°å€" class="reward-input meta-input bg-gray-50 border-gray-100 !h-10 md:!h-11 !text-xs md:!text-sm px-1 md:px-4 text-center">
                </div>
                <div class="space-y-2 text-center">
                    <label class="text-xs md:text-sm font-black text-gray-400 uppercase tracking-widest block text-center">è£½ä½œè€…å§“å</label>
                    <input type="text" id="creator-name" placeholder="å§“å" class="reward-input meta-input bg-gray-50 border-gray-100 !h-10 md:!h-11 !text-xs md:!text-sm px-1 md:px-4 text-center">
                </div>
            </div>
        </section>

        <!-- 3. è¶Ÿçæ˜ç´°å€åŸŸï¼š md ä»¥ä¸Šå¼·è¿«ä¸¦åˆ—é¡¯ç¤º -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
            <!-- å¹³æ—¥è¶Ÿç -->
            <section class="premium-card overflow-hidden text-center">
                <div class="bg-[#06C167] px-6 py-4 flex justify-between items-center text-white">
                    <h3 class="text-lg font-black tracking-tight uppercase">å¹³æ—¥è¶Ÿç (Tue-Thu)</h3>
                    <button onclick="exportMilestoneImage()" class="bg-white/20 hover:bg-white/30 text-[10px] font-black px-4 py-1.5 rounded-full border border-white/30 transition-all">è¼¸å‡ºåœ–ç‰‡</button>
                </div>
                <div class="p-6 space-y-6">
                    <div class="flex space-x-2 text-center">
                        <button data-group="wd" data-type="high" onclick="handleChipClick(this)" class="chip-btn text-center">é«˜æ¨™</button>
                        <button data-group="wd" data-type="top" onclick="handleChipClick(this)" class="chip-btn text-center">é ‚æ¨™</button>
                    </div>
                    <div class="grid grid-cols-1 gap-3" id="wd-all-inputs"></div>
                    <div class="grid grid-cols-3 gap-2 pt-6 border-t border-gray-50 text-center">
                        <div><p class="text-[9px] text-gray-400 font-bold uppercase">ç¸½è¶Ÿæ•¸</p><p class="text-lg font-black text-gray-900" id="wd-trips">0</p></div>
                        <div><p class="text-[9px] text-gray-400 font-bold uppercase text-[#06C167]">ç¸½é‡‘é¡</p><p class="text-lg font-black text-[#06C167]" id="wd-money">$0</p></div>
                        <div><p class="text-[9px] text-gray-400 font-bold uppercase">å¹³å‡</p><p class="text-lg font-black text-blue-500" id="wd-avg">$0</p></div>
                    </div>
                </div>
            </section>

            <!-- å‡æ—¥è¶Ÿç -->
            <section class="premium-card overflow-hidden text-center">
                <div class="bg-black px-6 py-4 flex justify-between items-center text-white">
                    <h3 class="text-lg font-black tracking-tight uppercase text-center text-white">å‡æ—¥è¶Ÿç (Fri-Mon)</h3>
                    <button onclick="exportMilestoneImage()" class="bg-white/10 hover:bg-white/20 text-[10px] font-black px-4 py-1.5 rounded-full border border-white/20 transition-all">è¼¸å‡ºåœ–ç‰‡</button>
                </div>
                <div class="p-6 space-y-6 text-center">
                    <div class="flex space-x-2 text-center">
                        <button data-group="we" data-type="high" onclick="handleChipClick(this)" class="chip-btn">é«˜æ¨™</button>
                        <button data-group="we" data-type="top" onclick="handleChipClick(this)" class="chip-btn">é ‚æ¨™</button>
                    </div>
                    <div class="grid grid-cols-1 gap-3 text-center" id="we-all-inputs"></div>
                    <div class="grid grid-cols-3 gap-3 pt-6 border-t border-gray-50 text-center text-center">
                        <div><p class="text-[9px] text-gray-400 font-bold uppercase">ç¸½è¶Ÿæ•¸</p><p class="text-lg font-black text-gray-900" id="we-trips">0</p></div>
                        <div><p class="text-[9px] text-gray-400 font-bold uppercase text-[#06C167]">ç¸½é‡‘é¡</p><p class="text-lg font-black text-[#06C167]" id="we-money">$0</p></div>
                        <div><p class="text-[9px] text-gray-400 font-bold uppercase">å¹³å‡</p><p class="text-lg font-black text-blue-500" id="we-avg">$0</p></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 4. é¤æœŸé¡å¤–åŠ ç¢¼çå‹µ (æ‰‹æ©Ÿç‰ˆå„ªåŒ–æ¨™é¡Œèˆ‡æŒ‰éˆ•ä¸¦åˆ—) -->
        <section class="premium-card overflow-hidden text-center">
            <div class="bg-blue-600 px-3 md:px-8 py-6 flex flex-row flex-nowrap justify-between items-center text-white text-center">
                <!-- æ‰‹æ©Ÿç‰ˆå­—é«”ç¸®è‡³ text-lg ä¸¦ç§»é™¤ pl-6 å¾€å·¦ç§»å‹•ï¼Œé…åˆ flex-nowrap ç¢ºä¿æŒ‰éˆ•ä¸è¢«æ“ ä¸‹ -->
                <h3 class="text-lg md:text-xl font-black tracking-tight shrink text-white pl-0 text-left">é¤æœŸé¡å¤–åŠ ç¢¼çå‹µ</h3>
                <div class="flex space-x-2 shrink-0 ml-2">
                    <button onclick="exportPeriodText()" class="bg-white/10 hover:bg-white/20 text-[10px] font-black px-3 py-1.5 rounded-full border border-white/10 transition-all text-white">æ–‡å­—è¤‡è£½</button>
                    <button onclick="exportPeriodImage()" class="bg-white text-blue-600 text-[10px] font-black px-3 py-1.5 rounded-full shadow-lg active:scale-95 transition-all">è¼¸å‡ºåœ–ç‰‡</button>
                </div>
            </div>
            
            <div class="p-2 md:p-8 overflow-x-hidden" id="daily-container">
                <!-- JS ç”Ÿæˆå…§å®¹ -->
            </div>

            <div class="mx-4 md:mx-6 mb-6 p-6 bg-blue-50/50 rounded-3xl flex items-center justify-between border border-blue-100 text-center">
                <div class="text-left text-center md:text-left">
                    <p class="text-[12px] text-blue-700 font-black uppercase tracking-widest mb-1 text-center md:text-left">æœ¬é€±é¤æœŸåˆè¨ˆåŠ ç¢¼é‡‘é¡</p>
                    <p class="text-3xl md:text-4xl font-black text-blue-800 tabular-nums" id="period-total">$0</p>
                </div>
                <div class="bg-blue-600 text-white p-4 rounded-3xl shadow-xl shadow-blue-100">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                </div>
            </div>
        </section>

        <!-- 5. åº•éƒ¨ç¸½é‡‘é¡æ‘˜è¦å€ -->
        <section class="hero-gradient p-10 md:p-14 rounded-3xl shadow-2xl text-white mt-12 flex flex-col lg:flex-row items-center justify-between gap-10">
            <div class="text-center lg:text-left flex-1 text-white">
                <h2 class="text-white opacity-70 text-[12px] font-black uppercase tracking-[0.5em] mb-3 text-center lg:text-left">æœ¬é€±çå‹µåˆè¨ˆ</h2>
                <div class="text-6xl md:text-8xl font-black tracking-tighter tabular-nums text-white text-center lg:text-left" id="grand-total-bottom">$0</div>
            </div>
            <div class="grid grid-cols-3 gap-2 md:gap-5 w-full lg:w-auto text-white">
                <div class="bg-white/10 backdrop-blur-md p-3 md:px-8 md:py-6 rounded-2xl border border-white/20 text-center min-w-[80px] md:min-w-[150px]">
                    <span class="text-[8px] md:text-xs font-bold text-white opacity-60 uppercase block mb-1">å¹³æ—¥è¶Ÿç</span>
                    <p id="sum-wd-bottom" class="text-sm md:text-3xl font-black text-white">$0</p>
                </div>
                <div class="bg-white/10 backdrop-blur-md p-3 md:px-8 md:py-6 rounded-2xl border border-white/20 text-center min-w-[80px] md:min-w-[150px]">
                    <span class="text-[8px] md:text-xs font-bold text-white opacity-60 uppercase block mb-1">å‡æ—¥è¶Ÿç</span>
                    <p id="sum-we-bottom" class="text-sm md:text-3xl font-black text-white">$0</p>
                </div>
                <div class="bg-white/10 backdrop-blur-md p-3 md:px-8 md:py-6 rounded-2xl border border-white/20 text-center min-w-[80px] md:min-w-[150px]">
                    <span class="text-[8px] md:text-xs font-bold text-blue-100 opacity-60 uppercase block mb-1 text-center">é¤æœŸåŠ ç¢¼</span>
                    <p id="sum-pd-bottom" class="text-sm md:text-3xl font-black text-blue-100">$0</p>
                </div>
            </div>
        </section>

    </main>

    <!-- [åœ–ç‰‡è¼¸å‡ºæ¨¡æ¿] (å›ºå®š 550px) -->
    <div id="export-period-image-card" class="export-hidden bg-white w-[550px] p-10">
        <div class="relative text-center border-b-4 border-[#06C167] pb-20 mb-8 text-center text-center">
            <h2 class="text-2xl font-black text-gray-900 tracking-tighter">UberEats æœ¬é€±é¤æœŸé¡å¤–çå‹µ</h2>
            <span id="img-period-region" class="absolute bottom-10 right-0 text-xs font-bold text-gray-400 text-center">åœ°å€: ---</span>
        </div>
        <table class="w-full text-left border-none">
            <thead>
                <tr class="text-[14px] text-black font-black uppercase tracking-widest border-b border-gray-50 text-center">
                    <th class="py-4 px-1 text-center">æ˜ŸæœŸ</th>
                    <th class="py-4 px-1 text-center">åˆé¤çå‹µ</th>
                    <th class="py-4 px-1 text-center">æ™šé¤çå‹µ</th>
                    <th class="py-4 px-1 text-right">æ¯æ—¥åˆè¨ˆ</th>
                </tr>
            </thead>
            <tbody id="img-period-body"></tbody>
        </table>
        <div class="mt-8 pt-8 border-t-2 border-dashed border-gray-100 text-center text-center">
            <p class="text-[16px] text-gray-900 font-black uppercase tracking-tight mb-10 text-center">æœ¬é€±é¤æœŸçå‹µåˆè¨ˆ</p>
            <p id="img-period-total" class="text-6xl font-black text-[#06C167] mt-1 text-center"></p>
            <div class="mt-14 flex justify-between text-[11px] text-gray-400 font-bold border-t border-gray-50 pt-4 text-center">
                <span id="meta-p-author">è£½ä½œè€…: ---</span>
                <span id="meta-p-date">è£½ä½œæ—¥æœŸ: ---</span>
            </div>
        </div>
    </div>

    <div id="export-ms-image-card" class="export-hidden bg-white w-[550px] p-10">
        <div class="relative text-center border-b-4 border-[#06C167] pb-20 mb-10 text-center text-center text-center">
            <h2 class="text-2xl font-black text-gray-900 tracking-tighter uppercase text-center text-center text-center">UberEats å¹³æ—¥èˆ‡å‡æ—¥è¶Ÿç</h2>
            <span id="img-ms-region" class="absolute bottom-10 right-0 text-xs font-bold text-gray-400 text-center text-center text-center">åœ°å€: ---</span>
        </div>
        <div class="flex text-center text-center text-center">
            <div class="flex-1 pr-8 border-r border-gray-200 text-center">
                <h3 class="text-[16px] font-black text-[#06C167] text-center mb-8 uppercase text-center">å¹³æ—¥è¶Ÿç</h3>
                <table class="w-full text-[19px] border-none text-center">
                    <tbody id="img-wd-rows" class="text-gray-600 font-medium"></tbody>
                    <tfoot>
                        <tr class="font-black text-gray-900 border-t border-gray-50 text-center">
                            <td class="pt-8 text-[15px] text-left">å¹³æ—¥åˆè¨ˆ</td>
                            <td class="pt-8 text-right text-[15px]" id="img-wd-sum-t">0è¶Ÿ</td>
                            <td class="pt-8 text-right text-[#06C167] text-[15px]" id="img-wd-sum-m">$0</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="flex-1 pl-8 text-center text-center text-center">
                <h3 class="text-[16px] font-black text-black text-center mb-8 uppercase text-center">å‡æ—¥è¶Ÿç</h3>
                <table class="w-full text-[19px] border-none text-center">
                    <tbody id="img-we-rows" class="text-gray-600 font-medium text-center"></tbody>
                    <tfoot>
                        <tr class="font-black text-gray-900 border-t border-gray-50 text-center text-center">
                            <td class="pt-8 text-[15px] text-left">å‡æ—¥åˆè¨ˆ</td>
                            <td class="pt-8 text-right text-[15px]" id="img-we-sum-t">0è¶Ÿ</td>
                            <td class="pt-8 text-right text-[#06C167] text-[15px]" id="img-we-sum-m">$0</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="mt-14 pt-10 border-t-4 border-double border-gray-100 text-center text-center text-center">
            <p class="text-[16px] text-gray-900 font-black uppercase tracking-widest mb-10 text-center">æœ¬é€±å¹³æ—¥èˆ‡å‡æ—¥è¶ŸçåŠ ç¸½</p>
            <div class="flex justify-center items-center gap-10 text-center text-center text-center">
                <p id="img-ms-grand-t" class="text-4xl font-black text-gray-900 text-center"></p>
                <p id="img-ms-grand-m" class="text-5xl font-black text-[#06C167] text-center"></p>
            </div>
            <div class="mt-14 flex justify-between text-[11px] text-gray-400 font-bold border-t border-gray-50 pt-4 px-2 text-center text-center text-center">
                <span id="meta-ms-author">è£½ä½œè€…: ---</span>
                <span id="meta-ms-date">è£½ä½œæ—¥æœŸ: ---</span>
            </div>
        </div>
    </div>

    <script>
        const uiDays = ['é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­', 'é€±æ—¥'];
        const fullDays = ['æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­', 'æ˜ŸæœŸæ—¥'];
        const labelMap = ['', 'ç¬¬ä¸€æ¨™', 'ç¬¬äºŒæ¨™', 'ç¬¬ä¸‰æ¨™', 'ç¬¬å››æ¨™', 'ç¬¬äº”æ¨™', 'ç¬¬å…­æ¨™', 'ç¬¬ä¸ƒæ¨™', 'ç¬¬å…«æ¨™'];

        const presets = {
            wd: {
                high: [{t: 30, m: 225}, {t: 15, m: 115}, {t: 15, m: 115}, {t: 15, m: 310}, {t: 15, m: 265}, {t: 10, m: 195}, {t: 10, m: 275}, {t: 0, m: 0}],
                top: [{t: 45, m: 340}, {t: 15, m: 115}, {t: 15, m: 310}, {t: 15, m: 265}, {t: 10, m: 115}, {t: 10, m: 355}, {t: 0, m: 0}, {t: 0, m: 0}]
            },
            we: {
                high: [{t: 65, m: 535}, {t: 5, m: 40}, {t: 5, m: 90}, {t: 10, m: 90}, {t: 15, m: 260}, {t: 20, m: 205}, {t: 20, m: 380}, {t: 20, m: 785}],
                top: [{t: 80, m: 710}, {t: 20, m: 175}, {t: 20, m: 490}, {t: 15, m: 345}, {t: 10, m: 320}, {t: 15, m: 555}, {t: 0, m: 0}, {t: 0, m: 0}]
            }
        };

        function init() {
            const dateInput = document.getElementById('creator-date');
            if (dateInput) dateInput.value = new Date().toISOString().split('T')[0];
            renderMilestones('wd'); renderMilestones('we'); renderDailyPeriods();
            setupListeners(); calculate();
        }

        function renderMilestones(prefix) {
            const container = document.getElementById(`${prefix}-all-inputs`);
            if (!container) return;
            for (let i = 1; i <= 8; i++) {
                container.innerHTML += `
                    <div class="flex items-center space-x-3 text-center">
                        <span class="text-[10px] font-black text-gray-300 w-8 uppercase shrink-0">M${i}</span>
                        <div class="grid grid-cols-2 gap-2 flex-1 text-center">
                            <div class="relative">
                                <input type="number" data-group="${prefix}" data-idx="${i}" data-f="t" placeholder="0" class="reward-input pr-5 h-9 md:h-11 text-xs md:text-sm text-center">
                                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-[8px] md:text-[9px] text-gray-400 font-black pointer-events-none uppercase">è¶Ÿ</span>
                            </div>
                            <div class="relative">
                                <input type="number" data-group="${prefix}" data-idx="${i}" data-f="m" placeholder="0" class="reward-input pr-5 h-9 md:h-11 text-xs md:text-sm text-center">
                                <span class="absolute right-2 top-1/2 -translate-y-1/2 text-[8px] md:text-[9px] text-gray-400 font-black pointer-events-none uppercase text-center">å…ƒ</span>
                            </div>
                        </div>
                    </div>`;
            }
        }

        function renderDailyPeriods() {
            const container = document.getElementById('daily-container');
            if (!container) return;
            uiDays.forEach((day, dIdx) => {
                container.innerHTML += `
                    <div class="flex flex-row items-center justify-between px-1 py-4 border-b border-gray-50 last:border-0 hover:bg-blue-50/20 transition-all rounded-2xl text-center">
                        <div class="flex flex-row items-center space-x-2 w-[75px] md:w-[85px] shrink-0 text-left">
                            <span class="font-black text-gray-700 text-[14px] text-left">${day}</span>
                            <span class="text-[11px] font-bold text-blue-600 uppercase tracking-tighter shrink-0 italic">$<span id="day-sum-${dIdx}">0</span></span>
                        </div>
                        <div class="flex flex-row items-center space-x-2 flex-1 justify-end">
                            <div class="flex flex-row items-center space-x-1 shrink-0">
                                <span class="text-[9px] font-black text-gray-300 uppercase shrink-0 text-center">åˆ</span>
                                <input type="number" data-day="${dIdx}" data-p="0" data-f="t" placeholder="è¶Ÿ" class="reward-input !w-[50px] md:!w-[80px] !h-9 md:!h-11 !text-[12px] md:!text-sm px-0">
                                <input type="number" data-day="${dIdx}" data-p="0" data-f="r" placeholder="å…ƒ" class="reward-input !w-[50px] md:!w-[80px] !h-9 md:!h-11 !text-[12px] md:!text-sm px-0 text-center">
                            </div>
                            <div class="w-[1px] h-6 bg-gray-100 shrink-0"></div>
                            <div class="flex flex-row items-center space-x-1 shrink-0">
                                <span class="text-[9px] font-black text-gray-300 uppercase shrink-0 text-center">æ™š</span>
                                <input type="number" data-day="${dIdx}" data-p="1" data-f="t" placeholder="è¶Ÿ" class="reward-input !w-[50px] md:!w-[80px] !h-9 md:!h-11 !text-[12px] md:!text-sm px-0 text-center">
                                <input type="number" data-day="${dIdx}" data-p="1" data-f="r" placeholder="å…ƒ" class="reward-input !w-[50px] md:!w-[80px] !h-9 md:!h-11 !text-[12px] md:!text-sm px-0 text-center">
                            </div>
                        </div>
                    </div>`;
            });
        }

        function setupListeners() {
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', () => {
                    const group = input.getAttribute('data-group');
                    if (group) {
                        document.querySelectorAll(`.chip-btn[data-group="${group}"]`).forEach(btn => btn.classList.remove('active'));
                    }
                    calculate();
                });
            });
        }

        function handleChipClick(btn) {
            const group = btn.getAttribute('data-group'), type = btn.getAttribute('data-type');
            const isActive = btn.classList.contains('active');
            document.querySelectorAll(`.chip-btn[data-group="${group}"]`).forEach(b => b.classList.remove('active'));
            if (!isActive) {
                btn.classList.add('active');
                if (presets[group][type]) {
                    presets[group][type].forEach((val, i) => {
                        const idx = i + 1;
                        const it = document.querySelector(`input[data-group="${group}"][data-idx="${idx}"][data-f="t"]`);
                        const im = document.querySelector(`input[data-group="${group}"][data-idx="${idx}"][data-f="m"]`);
                        if(it) it.value = val.t || ''; 
                        if(im) im.value = val.m || '';
                    });
                }
            }
            calculate();
        }

        function safeUpdate(id, text) {
            const el = document.getElementById(id);
            if (el) el.innerText = text;
        }

        function calculate() {
            const getVal = (p) => {
                let t = 0, m = 0;
                document.querySelectorAll(`input[data-group="${p}"][data-f="t"]`).forEach(i => t += Number(i.value) || 0);
                document.querySelectorAll(`input[data-group="${p}"][data-f="m"]`).forEach(i => m += Number(i.value) || 0);
                return { t, m };
            };
            const wd = getVal('wd'), we = getVal('we');
            safeUpdate('wd-trips', wd.t); safeUpdate('wd-money', '$' + wd.m.toLocaleString());
            safeUpdate('wd-avg', wd.t > 0 ? '$' + (wd.m/wd.t).toFixed(1) : '$0');
            safeUpdate('we-trips', we.t); safeUpdate('we-money', '$' + we.m.toLocaleString());
            safeUpdate('we-avg', we.t > 0 ? '$' + (we.m/we.t).toFixed(1) : '$0');
            let totalPd = 0;
            for (let d = 0; d < 7; d++) {
                let s = 0;
                for (let p = 0; p < 2; p++) {
                    const tr = Number(document.querySelector(`input[data-day="${d}"][data-p="${p}"][data-f="t"]`)?.value || 0);
                    const ra = Number(document.querySelector(`input[data-day="${d}"][data-p="${p}"][data-f="r"]`)?.value || 0);
                    s += (tr * ra);
                }
                const daySumEl = document.getElementById(`day-sum-${d}`);
                if(daySumEl) daySumEl.innerText = s.toLocaleString(); 
                totalPd += s;
            }
            safeUpdate('period-total', '$' + totalPd.toLocaleString());
            const gt = wd.m + we.m + totalPd;
            const gtText = '$' + gt.toLocaleString();
            safeUpdate('grand-total-bottom', gtText);
            document.querySelectorAll('#sum-wd-bottom').forEach(e => e.innerText = '$' + wd.m.toLocaleString());
            document.querySelectorAll('#sum-we-bottom').forEach(e => e.innerText = '$' + we.m.toLocaleString());
            document.querySelectorAll('#sum-pd-bottom').forEach(e => e.innerText = '$' + totalPd.toLocaleString());
        }

        async function exportPeriodImage() {
            const body = document.getElementById('img-period-body'); if (!body) return; body.innerHTML = '';
            let total = 0, maxV = -1;
            for (let i = 0; i < 7; i++) {
                const s = (Number(document.querySelector(`input[data-day="${i}"][data-p="0"][data-f="t"]`)?.value || 0) * Number(document.querySelector(`input[data-day="${i}"][data-p="0"][data-f="r"]`)?.value || 0)) + 
                          (Number(document.querySelector(`input[data-day="${i}"][data-p="1"][data-f="t"]`)?.value || 0) * Number(document.querySelector(`input[data-day="${i}"][data-p="1"][data-f="r"]`)?.value || 0));
                if (s > maxV) maxV = s;
            }
            fullDays.forEach((day, i) => {
                const t0 = Number(document.querySelector(`input[data-day="${i}"][data-p="0"][data-f="t"]`)?.value || 0), r0 = Number(document.querySelector(`input[data-day="${i}"][data-p="0"][data-f="r"]`)?.value || 0);
                const t1 = Number(document.querySelector(`input[data-day="${i}"][data-p="1"][data-f="t"]`)?.value || 0), r1 = Number(document.querySelector(`input[data-day="${i}"][data-p="1"][data-f="r"]`)?.value || 0);
                const sum = (t0 * r0) + (t1 * r1); total += sum;
                const isMax = (sum === maxV && maxV > 0);
                body.innerHTML += `<tr class="border-none text-center"><td class="py-4 px-1 font-black text-gray-900 text-[18px] text-center">${day}</td><td class="py-4 px-1 text-center text-gray-500 text-[18px] text-center">${t0}è¶Ÿx${r0}å…ƒ=${t0*r0}å…ƒ</td><td class="py-4 px-1 text-center text-gray-500 text-[18px] text-center">${t1}è¶Ÿx${r1}å…ƒ=${t1*r1}å…ƒ</td><td class="py-4 px-1 text-right font-black ${isMax ? 'text-[#06C167]' : 'text-gray-900'} text-[19px] text-right">$${sum}</td></tr>`;
            });
            const info = getInfo(); safeUpdate('img-period-total', `$${total.toLocaleString()}`); safeUpdate('img-period-region', `åœ°å€: ${info.region}`); safeUpdate('meta-p-author', `è£½ä½œè€…: ${info.name}`); safeUpdate('meta-p-date', `è£½ä½œæ—¥æœŸ: ${info.date}`);
            const canvas = await html2canvas(document.getElementById('export-period-image-card'), { scale: 2 }); download(canvas, "Period_Reward");
        }

        async function exportMilestoneImage() {
            const wR = document.getElementById('img-wd-rows'), eR = document.getElementById('img-we-rows'); if (!wR || !eR) return; wR.innerHTML = ''; eR.innerHTML = '';
            let wtS = 0, wmS = 0, etS = 0, emS = 0;
            for(let i=1; i<=8; i++) {
                const wt = Number(document.querySelector(`input[data-group="wd"][data-idx="${i}"][data-f="t"]`)?.value || 0), wm = Number(document.querySelector(`input[data-group="wd"][data-idx="${i}"][data-f="m"]`)?.value || 0);
                wtS += wt; wmS += wm; wR.innerHTML += `<tr><td class="py-3 text-gray-400 font-medium text-[18px] text-left text-center">${labelMap[i]}</td><td class="text-right text-black font-black text-[19px] text-center">${wt}è¶Ÿ</td><td class="text-right text-[#06C167] font-black text-[19px] text-center">$${wm}</td></tr>`;
                const et = Number(document.querySelector(`input[data-group="we"][data-idx="${i}"][data-f="t"]`)?.value || 0), em = Number(document.querySelector(`input[data-group="we"][data-idx="${i}"][data-f="m"]`)?.value || 0);
                etS += et; emS += em; eR.innerHTML += `<tr><td class="py-3 text-gray-400 font-medium text-[18px] text-left text-center">${labelMap[i]}</td><td class="text-right text-black font-black text-[19px] text-center">${et}è¶Ÿ</td><td class="text-right text-[#06C167] font-black text-[19px] text-center">$${em}</td></tr>`;
            }
            const info = getInfo(); safeUpdate('img-wd-sum-t', `${wtS}è¶Ÿ`); safeUpdate('img-wd-sum-m', `$${wmS.toLocaleString()}`); safeUpdate('img-we-sum-t', `${etS}è¶Ÿ`); safeUpdate('img-we-sum-m', `$${emS.toLocaleString()}`); safeUpdate('img-ms-grand-t', `${wtS + etS} è¶Ÿ`); safeUpdate('img-ms-grand-m', `$${(wmS + emS).toLocaleString()}`); safeUpdate('img-ms-region', `åœ°å€: ${info.region}`); safeUpdate('meta-ms-author', `è£½ä½œè€…: ${info.name}`); safeUpdate('meta-ms-date', `è£½ä½œæ—¥æœŸ: ${info.date}`);
            const canvas = await html2canvas(document.getElementById('export-ms-image-card'), { scale: 2 }); download(canvas, "Milestone_Reward");
        }

        function download(c, n) { const l = document.createElement('a'); l.download = `UberEats_${n}_${Date.now()}.png`; l.href = c.toDataURL("image/png"); l.click(); }
        function closeModal() { document.getElementById('modal-export').classList.add('hidden'); }
        function copyToClipboard() { const a = document.getElementById('output-area'); a.select(); document.execCommand('copy'); const b = document.getElementById('copy-btn'); b.innerText = "å·²è¤‡è£½ï¼"; setTimeout(() => { b.innerText = "è¤‡è£½æ–‡å­—"; closeModal(); }, 1000); }
        function clearAll() { if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ•¸æ“šå—ï¼Ÿ')) { document.querySelectorAll('input:not([type="date"])').forEach(i => i.value = ''); document.querySelectorAll('.chip-btn').forEach(b => b.classList.remove('active')); calculate(); window.scrollTo({top:0,behavior:'smooth'}); } }
        function exportPeriodText() {
            let out = ""; let total = 0, maxV = -1, best = -1;
            fullDays.forEach((day, i) => {
                const t0 = Number(document.querySelector(`input[data-day="${i}"][data-p="0"][data-f="t"]`)?.value || 0), r0 = Number(document.querySelector(`input[data-day="${i}"][data-p="0"][data-f="r"]`)?.value || 0, t1 = Number(document.querySelector(`input[data-day="${i}"][data-p="1"][data-f="t"]`)?.value || 0), r1 = Number(document.querySelector(`input[data-day="${i}"][data-p="1"][data-f="r"]`)?.value || 0));
                const s = (t0 * r0) + (t1 * r1); total += s; if (s > maxV) { maxV = s; best = i; }
                out += `${day} åˆè¨ˆ${s}å…ƒ\nåˆé¤${t0}è¶Ÿ${r0}å…ƒ æ™šé¤${t1}è¶Ÿ${r1}å…ƒ\n`;
            });
            out += `\næœ¬é€±é¤æœŸåŠ ç¢¼å…±${total}å…ƒ\n`;
            if (maxV > 0) out += `é€±${uiDays[best].replace('é€±','')}æ˜¯æœ¬é€±æœ€é«˜çš„é¤æœŸåŠ ç¢¼\nå…±æœ‰${maxV}å…ƒï¼Œåƒè¬åˆ¥æ”¾éä»–äº†ğŸ¤‘`;
            document.getElementById('output-area').value = out; document.getElementById('modal-export').classList.remove('hidden');
        }
        function getInfo() { return { name: document.getElementById('creator-name')?.value || "æœªå¡«å¯«", date: document.getElementById('creator-date')?.value || new Date().toISOString().split('T')[0], region: document.getElementById('creator-region')?.value || "æœªå¡«å¯«" }; }
        window.onload = init;
    </script>
</body>
</html>